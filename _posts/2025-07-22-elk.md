---
layout: single
title: "Elasticsearch ê¸°ì´ˆ - ì¸ë±ìŠ¤, ë„íë¨¼íŠ¸, CRUD"
categories: DataEngineering
tag: [Elasticsearch]
search: true
typora-root-url: ../
sidebar:
  nav: "counts"








---



**[Elasticsearch][Elasticsearch ê¸°ì´ˆ - ì¸ë±ìŠ¤, ë„íë¨¼íŠ¸, CRUD ì •ë³µí•˜ê¸°**](https://park-chanyeong.github.io)
{: .notice--primary}

# 1. Elasticsearchì˜ ìƒíƒœ í™•ì¸ì€?

Kibana ì½˜ì†”ì„ ì¼œë†“ê³  GET `_cat` APIë¥¼ ë‚ ë ¤ë³´ë©´ ê³ ì–‘ì´ ì´ëª¨ì§€ë‘ í•¨ê»˜ ê·€ì—¬ìš´(?) í´ëŸ¬ìŠ¤í„° ìƒíƒœ ì •ë³´ë“¤ì´ ëœ¸. 
 ì´ëŠ” Elasticsearchì˜ ìƒíƒœë‚˜ êµ¬ì„± ìš”ì†Œë“¤ì„ í…ìŠ¤íŠ¸ ê¸°ë°˜ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆëŠ” ìœ ìš©í•œ ëª…ë ¹ì–´ì„.

```bash
GET _cat
```

`/_cat/indices`, `/_cat/nodes`, `/_cat/shards`, `/_cat/plugins` ë“± ë‹¤ì–‘í•œ ì—”ë“œí¬ì¸íŠ¸ë¥¼ í†µí•´ ì¸ë±ìŠ¤ ìƒíƒœ, ìƒ¤ë“œ ë¶„í¬, ë…¸ë“œ ì •ë³´ ë“±ì„ ì¡°íšŒ ê°€ëŠ¥í•¨. 

![image-20250725045052503](/images/2025-07-25-elk/image-20250725045052503.png) íŠ¹íˆ `/_cat/indices?v`ì²˜ëŸ¼ `?v` íŒŒë¼ë¯¸í„°ë¥¼ ë¶™ì´ë©´ í—¤ë”ê°€ í•¨ê»˜ ì¶œë ¥ë˜ê³ , `?s=docs.count:desc`ì²˜ëŸ¼ ì •ë ¬ ì˜µì…˜ë„ ì œê³µë¨.

------

# 2. ì¸ë±ìŠ¤ì™€ ë„íë¨¼íŠ¸ì˜ ê°œë…

Elasticsearchì—ì„œ **ì¸ë±ìŠ¤(Index)** ëŠ” ë„íë¨¼íŠ¸ë¥¼ ì €ì¥í•˜ëŠ” ë…¼ë¦¬ì ì¸ ê³µê°„ì„. ë°˜ëŒ€ë¡œ **ë„íë¨¼íŠ¸(Document)** ëŠ” ì¸ë±ìŠ¤ì— ì €ì¥ë˜ëŠ” JSON í˜•ì‹ì˜ ì‹¤ì œ ë°ì´í„°ì„.

| RDB ê°œë… | Elasticsearch ê°œë… |
| -------- | ------------------ |
| Database | Cluster            |
| Table    | Index              |
| Row      | Document           |
| Column   | Field              |
| Schema   | Mapping            |

Elasticsearch 7.x ì´í›„ë¶€í„°ëŠ” "type" ê°œë…ì´ ì œê±°ë˜ì–´ `_doc`ë§Œ ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš©ë¨.

ë„íë¨¼íŠ¸ ì˜ˆì‹œ:

```json
{
  "name": "chan",
  "age": 26,
  "gender": "male"
}
```

ë„íë¨¼íŠ¸ëŠ” JSON í˜•ì‹ìœ¼ë¡œ í‘œí˜„ë˜ê³ , ë‚´ë¶€ì—ëŠ” í•„ë“œ(field)ì™€ ê°’ì´ ì¡´ì¬í•¨. 
 ElasticsearchëŠ” ì´ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìë™ìœ¼ë¡œ ìŠ¤í‚¤ë§ˆë¥¼ ì¶”ë¡ í•˜ëŠ”ë°, ì´ë¥¼ **ë‹¤ì´ë‚˜ë¯¹ ë§¤í•‘(Dynamic Mapping)** ì´ë¼ê³  í•¨.

![image-20250725050630687](/images/2025-07-25-elk/image-20250725050630687.png)

> ì¸ë±ìŠ¤ëŠ” ë„íë¨¼íŠ¸ë¥¼ ë¬´ì œí•œìœ¼ë¡œ ì €ì¥í•  ìˆ˜ ìˆì§€ë§Œ, ì„±ëŠ¥ì„ ê³ ë ¤í•´ **ì‹œê°„ ë‹¨ìœ„ ì¸ë±ìŠ¤ ë¶„ë¦¬**, **ë°ì´í„° ì‚­ì œ ì •ì±…**, **ì¸ë±ìŠ¤ í…œí”Œë¦¿ í™œìš©** ë“±ì˜ ì „ëµì´ í•„ìš”í•¨.



------

# 3. ì¸ë±ìŠ¤ ìƒì„± ë° ë„íë¨¼íŠ¸ ì¸ë±ì‹±

### ì¸ë±ìŠ¤ ìƒì„±

```bash
PUT index1
```

### ì¸ë±ìŠ¤ í™•ì¸ / ì‚­ì œ

```bash
GET index1
DELETE index1
```

### ë„íë¨¼íŠ¸ ì¸ë±ì‹± (ìƒì„±)

```bash
PUT index2/_doc/1
{
  "name": "chan",
  "age": 26,
  "gender": "male"
}
```

- `_doc`: íƒ€ì… êµ¬ë¶„ìš© (ì‚¬ì‹¤ìƒ ê³ ì •)
- `1`: ë„íë¨¼íŠ¸ì˜ ê³ ìœ  ID (ìƒëµ ì‹œ ìë™ í• ë‹¹ë¨)
- ìœ„ì²˜ëŸ¼ ì €ì¥í•˜ëŠ” ì‘ì—…ì„ **ì¸ë±ì‹±(Indexing)** ì´ë¼ê³  ë¶€ë¦„

### ë§¤í•‘ í™•ì¸

```bash
GET index2/_mapping
```

ìë™ìœ¼ë¡œ ì¶”ë¡ ëœ ë§¤í•‘ ì˜ˆì‹œ:

```json
"properties": {
  "age": { "type": "long" },
  "gender": { "type": "text", "fields": { "keyword": { "type": "keyword" } } },
  "name": { "type": "text", "fields": { "keyword": { "type": "keyword" } } }
}
```

`text`ëŠ” ë¶„ì„ ê°€ëŠ¥í•œ í•„ë“œ, `keyword`ëŠ” ì •ë ¬/ì§‘ê³„ìš© í•„ë“œì„.

### í•„ë“œê°€ ë‹¤ë¥¸ ë„íë¨¼íŠ¸ ì¸ë±ì‹±ë„ ê°€ëŠ¥í•¨

```bash
PUT index2/_doc/2
{
  "name": "Jane",
  "country": "korea"
}
```

RDBì—ì„œëŠ” ìŠ¤í‚¤ë§ˆê°€ ë§ì§€ ì•Šìœ¼ë©´ ì˜¤ë¥˜ê°€ ë‚˜ì§€ë§Œ, ElasticsearchëŠ” ì´ë¥¼ í—ˆìš©í•˜ê³  ë§¤í•‘ì„ í™•ì¥í•¨.

### íƒ€ì…ì´ ë‹¬ë¼ë„ ìë™ ë³€í™˜í•¨

```bash
PUT index2/_doc/3
{
  "name": "pcy",
  "age": "27",
  "country": "USA"
}
```

`age`ê°€ ìˆ«ìì¸ë° ë¬¸ìì—´ë¡œ ë„£ì—ˆì§€ë§Œ, ë‚´ë¶€ì ìœ¼ë¡œ ë³€í™˜ë¨. ì´ê±´ ìœ ì—°í•˜ê¸´ í•˜ì§€ë§Œ **íƒ€ì… ì˜¤ë¥˜ ì£¼ì˜ í•„ìš”**



------

# 4. ë„íë¨¼íŠ¸ ì¡°íšŒ (Read)

### 1. ë„íë¨¼íŠ¸ IDë¡œ ì¡°íšŒ

```bash
GET index2/_doc/1
```

- `_id` ê°’ìœ¼ë¡œ ì§ì ‘ ë„íë¨¼íŠ¸ë¥¼ ê°€ì ¸ì˜´

### 2. ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ID ì¡°íšŒ ì‹œ

```bash
GET index2/_doc/9999
```

- 404 ì—ëŸ¬ ë°œìƒ

ì¶”í›„ DSL ë°©ì‹ ê²€ìƒ‰ì€ ë³„ë„ í¬ìŠ¤íŒ…ì—ì„œ ë‹¤ë£° ì˜ˆì •ì„

------

# 5. ë„íë¨¼íŠ¸ ìˆ˜ì • (Update)

### ì „ì²´ ë®ì–´ì“°ê¸° ë°©ì‹

```bash
PUT index2/_doc/1
{
  "name": "pcy",
  "age": 27,
  "country": "USA"
}
```

### ë¶€ë¶„ ì—…ë°ì´íŠ¸ ë°©ì‹ (Update API)

```bash
POST index2/_update/1
{
  "doc": {
    "name": "lee"
  }
}
```

ì—…ë°ì´íŠ¸ ì‹œ ì‹¤ì œë¡œëŠ” **ì‚­ì œ í›„ ì¬ì‚½ì…**ê³¼ ìœ ì‚¬í•œ ë™ì‘ì„ í•˜ê¸° ë•Œë¬¸ì—, ë¹„ìš©ì´ í¼. 
 ElasticsearchëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë¡œê·¸ ê¸°ë°˜ ì‹œìŠ¤í…œì´ê¸° ë•Œë¬¸ì—, **ìˆ˜ì •ë³´ë‹¨ ìƒˆë¡œ ì¸ë±ì‹±í•˜ëŠ” ê²Œ ì¼ë°˜ì **ì„.

------

# 6. ë„íë¨¼íŠ¸ ì‚­ì œ (Delete)

```bash
DELETE index2/_doc/2
```

ì‚­ì œ ì‹œ `_version`ì´ ì˜¬ë¼ê°€ê³ , ì‹¤ì œë¡œëŠ” soft delete ì²˜ë¦¬ë˜ì–´ ë‚˜ì¤‘ì— GCë¡œ ì œê±°ë¨.

------

# 7. REST API ì‘ë‹µ ì½”ë“œ

| ìƒíƒœ ì½”ë“œ | ì˜ë¯¸                     |
| --------- | ------------------------ |
| 200       | ì •ìƒ ì‘ë‹µ                |
| 201       | ìƒì„± ì„±ê³µ (POST ë“±)      |
| 404       | ë¦¬ì†ŒìŠ¤ ì—†ìŒ              |
| 405       | ë©”ì„œë“œ ë¶ˆí—ˆ              |
| 429       | ê³¼ë„í•œ ìš”ì²­ (rate limit) |
| 5xx       | ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜           |

------

# 8. Bulk APIë¡œ ëŒ€ëŸ‰ ì¸ë±ì‹± ì²˜ë¦¬

ë„íë¨¼íŠ¸ë¥¼ í•˜ë‚˜í•˜ë‚˜ ì¸ë±ì‹±í•˜ëŠ” ê±´ REST ìš”ì²­ íšŸìˆ˜ê°€ ë§ì•„ì ¸ ë§¤ìš° ë¹„íš¨ìœ¨ì ì„.  ElasticsearchëŠ” ì´ë¥¼ ìœ„í•´ **Bulk API**ë¥¼ ì œê³µí•˜ë©°, í•œ ë²ˆì˜ ìš”ì²­ìœ¼ë¡œ ìˆ˜ì‹­~ìˆ˜ë°± ê°œì˜ ì‘ì—…ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆìŒ.

### Bulk API íŠ¹ì§•ì€?

- **POST** ë°©ì‹ ì‚¬ìš©
- **/_bulk** ì—”ë“œí¬ì¸íŠ¸ë¡œ í˜¸ì¶œ
- ë³¸ë¬¸ì€ **NDJSON(Newline Delimited JSON)** í˜•ì‹ì´ì–´ì•¼ í•¨
- ê° ì¤„ì€ í•˜ë‚˜ì˜ ì‘ì—… ë‹¨ìœ„ë¥¼ ë‚˜íƒ€ë‚´ë©°, ì‘ì—…ëª…(`index`, `update`, `delete`)ê³¼ ì‹¤ì œ ë°ì´í„°ê°€ **ë¼ì¸ ë‹¨ìœ„ë¡œ ìŒìœ¼ë¡œ ì¡´ì¬í•¨**
- `Content-Type`ì€ ë°˜ë“œì‹œ `application/x-ndjson`ìœ¼ë¡œ ì§€ì •í•´ì•¼ í•¨

### ğŸ”¹ ì–´ë–»ê²Œ ë„£ì–´ìœ 

```
POST _bulk
{ "index": { "_index": "index2", "_id": "6" } }
{ "name": "hong", "age": 10, "gender": "female" }
{ "index": { "_index": "index2", "_id": "7" } }
{ "name": "choi", "age": 90, "gender": "male" }
{ "delete": { "_index": "index2", "_id": "7" } }
```

- **index**: ë„íë¨¼íŠ¸ë¥¼ ìƒì„± ë˜ëŠ” ë®ì–´ì“°ê¸°
- **delete**: ë„íë¨¼íŠ¸ ì‚­ì œ
- **update**ë„ ê°€ëŠ¥í•˜ë‚˜, ë‚´ë¶€ì ìœ¼ë¡œëŠ” `_update`ì™€ ìœ ì‚¬í•˜ê²Œ ë™ì‘í•¨

### ğŸ”¹ update ì˜ˆì‹œ

```
{ "update": { "_index": "index2", "_id": "6" } }
{ "doc": { "gender": "nonbinary" } }
```

> ì°¸ê³ : `update` ì‘ì—…ë„ ë‘ ì¤„ êµ¬ì„±ì´ë©°, ë‘ ë²ˆì§¸ ì¤„ì—ëŠ” `doc` í‚¤ë¥¼ ì¨ì•¼ í•¨

## ê·¼ë° ì‹¤ì œë¡œëŠ” íŒŒì¼ë¡œ ë§Œë“¤ì–´ì„œ bulk ì‹¤í–‰í•œë‹¤ë„¤ìœ 

NDJSON ë°ì´í„°ë¥¼ `.ndjson` í™•ì¥ìë¡œ ì €ì¥ í›„ `curl` ëª…ë ¹ì–´ë¡œ ì „ì†¡í•¨

### ğŸ”¹ bulk_data.ndjson íŒŒì¼ë¡œ ë§Œë“¤ì–´ì„œ

```
{ "index": { "_index": "index2", "_id": "10" } }
{ "name": "kim", "age": 33, "gender": "male" }
{ "index": { "_index": "index2", "_id": "11" } }
{ "name": "yuna", "age": 25, "gender": "female" }
{ "delete": { "_index": "index2", "_id": "10" } }
```

### ğŸ”¹ curl ëª…ë ¹ì–´ ì‹¤í–‰

```
curl -H "Content-Type: application/x-ndjson" \
     -X POST localhost:9200/_bulk \
     --data-binary @bulk_data.ndjson
```

- `-H`: í—¤ë” ì„¤ì • (NDJSON)
- `-X`: HTTP ë©”ì„œë“œ ì§€ì • (POST)
- `--data-binary`: ë°”ì´ë„ˆë¦¬ ì „ì†¡ (newline ë³´ì¡´)
- `@íŒŒì¼ëª…`: ë¡œì»¬ íŒŒì¼ ì…ë ¥

###  ìœ ì˜ì‚¬í•­

- ì¤„ë§ˆë‹¤ JSON ê°ì²´ì§€ë§Œ **ì‰¼í‘œ(,) ì—†ìŒ**, ì¤„ ì‚¬ì´ **ê³µë°± ì—†ìŒ**
- íŒŒì¼ì˜ **ëì—ë„ ê°œí–‰ ë¬¸ì ê¼­ í•„ìš”** (ì•ˆ ê·¸ëŸ¬ë©´ ë§ˆì§€ë§‰ ë¼ì¸ì´ ë¬´ì‹œë  ìˆ˜ ìˆìŒ)
- **ì½ê¸° ì‘ì—…(GET)** ì€ Bulk APIì—ì„œ ì§€ì›ë˜ì§€ ì•ŠìŒ (ì“°ê¸° ì „ìš©)



# ë„ì•.





